<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" />

    <style>
      body { font-family: Tahoma, Geneva, sans-serif; }
    </style>

    <!-- colyseus.js client -->
    <script type="text/javascript" src="https://raw.githack.com/colyseus/colyseus.js/master/dist/colyseus.js"></script>

  </head>
  <body>
    <p>Lobby. It just broadcast messages through "broadcast" method.</p>

    <script>
      var client = new Colyseus.Client("ws://localhost:2567");
      var n = 0;
      client.joinOrCreate("lobby", {name: 'Jacks'}).then(room => {
        console.log("joined");
        room.onStateChange.once(function(state) {
            console.log("initial room state:", state);
        });

        // new room state
        room.onStateChange(function(state) {
            console.log(++n);
            console.log(state);
        });

        // listen to patches coming from the server
        room.onMessage("rooms", function(message) {
            console.log("rooms:" + message);
        });

        room.onMessage("+", ([roomId, room]) => {
          console.log("new room added", roomId);
          console.log(room);
        });

        room.onMessage("-", (roomId) => {
          console.log("Room removed!", roomId);
        });

        room.onStateChange.once((state) => {
          console.log("this is the first room state!", state);
        });

        room.onStateChange((state) => {
          console.log("the room state has been updated:", state);
        });
      });
      //client.message("query", {name:"Poke"});
      setInterval(getNPrint, 5000);

      function getNPrint(){
        console.log("printting...");
        console.log("roomId", "clients", "maxClients", "metadata");
        client.getAvailableRooms("game").then(rooms => {
          rooms.forEach((room) => {
            console.log(room.roomId, room.clients, room.maxClients, room.metadata);
          });
        }).catch(e => {
          console.error(e);
        })
      }

    </script>
  </body>
</html>
